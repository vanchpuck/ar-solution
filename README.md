# AR-Solution
Вызов функций описанный в примерах требует запуска AR-Solution на локальной машине
На данный момент REST API для взаимодействия с сетью выглядит следующим образом:
# Регистрация пользователя
Выполняет регистрацию пользователя в CA. Запрос возвращает авторизационный токен, который необходим для вызова любого метода через REST API. Вызов данного метода можно использовать как при регистрации нового пользователя, так и для получения токена ранее зарегистрированного пользователя.
### Пример вызова: 
```
curl -s -X POST \
  http://localhost:4000/users \
  -H "content-type: application/x-www-form-urlencoded" \
  -d 'username=Jim&orgName=org1')
  ```
В результате вызова получим авторизационный токен для пользователя Jim из организации org1
# Создание канала
Выполняет создание канала mychannel. Имя канала в параметрах запроса должно соответствовать имени канала, указанному при создании файла транзакции создания канала.
### Пример вызова: 
```
curl -s -X POST \
  http://localhost:4000/channels \
  -H "authorization: Bearer $ORG1_TOKEN" \
  -H "content-type: application/json" \
  -d '{
	"channelName":"mychannel",
	"channelConfigPath":"../artifacts/channel/mychannel.tx"
}'
```
В качестве параметров запроса используется имя канала, а также путь к файлу транзакции создания канала. Также в заголовке запроса необходимо указать авторизационный токен, полученный при авторизации пользователя через CA.
# Присоединение организации к каналу
Выполняет подключение организации к каналу.
### Пример использования
```
curl -s -X POST \
  http://localhost:4000/channels/mychannel/peers \
  -H "authorization: Bearer $ORG1_TOKEN" \
  -H "content-type: application/json" \
  -d '{
	"peers": ["peer1","peer2"]
}'
```
В параметрах запроса необходимо указать список пиров организаии (тут всё довольно мутно, есть некоторые вопросы), а также авторизационный токен.
# Инсталляция чейнкода 
Выполняет инсталляцию ченкода на пиры организации. Чейнкод должен быть установлен на пиры каждой из организаций в канале.
### Пример использования
```
curl -s -X POST \
  http://localhost:4000/chaincodes \
  -H "authorization: Bearer $ORG1_TOKEN" \
  -H "content-type: application/json" \
  -d '{
        "peers": ["peer1", "peer2"],
        "chaincodeName":"cctest",
        "chaincodePath":"github.com/ar_solution",
        "chaincodeVersion":"v0"
}'
```
В параметрах запроса необходимо указать список пиров организации, имя чейнкода, путь к исходным файлам чейнкода, а также версию чейнкода. Не забываем про авторизационный токен.
# Инициализация чейнкода
Выполняет инициализацию чейнкода. Ченкод может быть инициализирован только одной организацией в канале, инициализация для всех организаций в канале не требудется.
### Пример использования
```
curl -s -X POST \
  http://localhost:4000/channels/mychannel/chaincodes \
  -H "authorization: Bearer $ORG1_TOKEN" \
  -H "content-type: application/json" \
  -d '{
        "chaincodeName":"cctest",
        "chaincodeVersion":"v0",
        "args":[]
}'
```
В качестве параметров запроса необходимо указать имя чейнкода, а также его версию. Не забываем авторизационный токен. От того, чей авторизационный токен будет использован, зависит от чьего имени будет инициализирован чейнкод.
# Создание записи об оплате
Создает запись о документе оплаты в БД. 
### Пример использования
```
curl -s -X POST \
  http://localhost:4000/channels/mychannel/chaincodes/cctest \
  -H "authorization: Bearer $ORG1_TOKEN" \
  -H "content-type: application/json" \
  -d '{
        "fcn":"doPayment",
        "args":["0001","Рога и копыта","20180112","Рога и копыта","Геркулес","300"]
}'
```
Параметры запроса:
- fcn - имя функции в чейнкоде
- args - аргументы функции (номер документа, наименование организаии инициатора записи, дата документа, наименование организации отправителя платежа, наименование организации получателя платежа, сумма платежа)
В результате вызова в БД создается запись следующего вида:
```
 "_id": "cctest\u0000Рога и копыта-0001",
 "_rev": "1-7aee17713ca800be4b3ebb13d09983fb",
 "chaincodeid": "cctest",
 "data": {
  "docNum": "0001",
  "submitter": "Рога и копыта",
  "docType": "PAYMENT",
  "date": "20180112",
  "sender": "Рога и копыта",
  "recepient": "Геркулес",
  "amount": "300",
  "status": "COMMITTED"
 },
 "version": "2:0"
```
Статус записи при создании - COMMITTED.
На данный момент для организаций не предусмотрено понятие первичного ключа. Этот вопрос обсудим позже.
# Создание записи о поставке
Создает запись о документе поставки в ДБ.
### Пример использования
```
curl -s -X POST \
  http://localhost:4000/channels/mychannel/chaincodes/cctest \
  -H "authorization: Bearer $ORG1_TOKEN" \
  -H "content-type: application/json" \
  -d '{
        "fcn":"doSupply",
        "args":["001","Org2","17032019","Org2","Org1","500"]
}'
```
Параметры соответствуют параметрам функции для создания документа оплаты.
# Отмена записи (распроведение)
Изменяет статус имеющейся записи с COMMITTED на CANCELED. 
### Пример использования
```
curl -s -X POST \
  http://localhost:4000/channels/mychannel/chaincodes/cctest \
  -H "authorization: Bearer $ORG1_TOKEN" \
  -H "content-type: application/json" \
  -d '{
        "fcn":"cancelDoc",
        "args":["Org1", "002"]
}'
```
В качестве параметров принимает наименование организации и номер документа для распроведения.
# Получения списка документов оплаты
Возвращает список документов оплаты. Есть возможность получения всех документов оплаты или документов с опрееленным статусом (COMMITTED, CANCELED). На данный момент нам больше интересно получение списка проведенных (COMMITTED) документов.
### Пример использования
```
curl -s -X GET \
  "http://localhost:4000/channels/mychannel/chaincodes/cctest?peer=peer1&fcn=queryCommittedSupplyDocs&args=%5B%5D" \
  -H "authorization: Bearer $ORG1_TOKEN" \
  -H "content-type: application/json"
```
В параметрах GET запроса передается имя одного из пиров организаии (пока не совсем ясно, какой из пиров нужно указывать. Пока скажем, что можно указывать любой.), имя функции и список URL-Encoded аргументов функции В данном случае список аргументов пуст.
Функция возвращает запись следующего вида:
```
Key: undefined. Value: [{"Key":"Org2-001", "Record":{"amount":"500","date":"17032019","docNum":"001","docType":"SUPPLY","recepient":"Org1","sender":"Org2","status":"COMMITTED","submitter":"Org2"}}]

```
На выходе имеем строку, содержащую список json-объектов. Каждый json-объектов имеет следующую структуру:
- key - клуюч запси в БД (Ключ имеет структуру <Submitter>-<DocumentNumber>)
- Record - json-объект, содержащий данные документа в БД.
Все функции, возвращающие список документов, имеют сходный формат возвращаемых значений.
# Получения списка документов поставки
Возвращает список документов поставки. Есть возможность получения всех документов поставки или документов с опрееленным статусом (COMMITTED, CANCELED). На данный момент нам больше интересно получение списка проведенных (COMMITTED) документов.
### Пример использования
```
curl -s -X GET \
  "http://localhost:4000/channels/mychannel/chaincodes/cctest?peer=peer1&fcn=queryCommittedSupplyDocs&args=%5B%5D" \
  -H "authorization: Bearer $ORG1_TOKEN" \
  -H "content-type: application/json"
```
Параметры запроса соответствуют параметрам для функции получения документов оплаты. То же - для возвращаемого результата.

Более подробно с примерами вызова REST API можно ознакомиться, заглянув в исходный код скрипта testAPIs.sh
